<!-- 챕터 6: 좀비 군대 보여주기
    자네가 컨트랙트로부터 받은 데이터를 실제로 보여줄 수 없다면 이 튜토리얼은 완전하다고 할 수 없을 것이네.
    하지만, 현실적으로 자네는 React나 Vue.js 같은 프론트엔드 프레임워크를 사용하고 싶을 수도 있네. 그것들이 프론트엔드 개발자로서의 자네의 삶을 훨씬 편하게 만들어주기 때문이지. 
    하지만 React 또는 Vue.js 를 다루는 것은 이 튜토리얼의 범주 밖에 있다네 - 그건 그 자체로 여러 레슨으로 이루어진 튜토리얼이 될 것이네.
    그래서 CryptoZombies.io의 초점을 이더리움과 스마트 컨트랙트에 맞추기 위해, 우리는 jQuery를 이용한 간단한 예제를 통해 어떻게 자네가 스마트 컨트랙트에서 전달받은 데이터를 파싱하고 표현할 수 있을지 보여줄 것이네.
    
    _좀비 데이터 보여주기 - 간단한 예제
    내가 먼저 우리 문서의 내용에 빈 <div id="zombies"></div>와 빈 displayZombies 함수를 추가해 놓았네.
    지난 챕터에서 우리가 startApp() 내에서 getZombiesByOwner의 호출 결과를 써서 호출한 displayZombies를 상기해보게. 그 함수의 결과로 아래와 같이 생긴 좀비 ID 배열을 전달받을 수 있을 걸세:
    [0, 13, 47]
    따라서 displayZombies 함수는 다음과 같은 것을 할 것이네:
    1. 먼저 이미 무언가가 #zombies div의 안에 들어 있다면 이 div의 내용을 비우게(이렇게 하면 사용자가 그들의 활성화된 MetaMask 계정을 변경하면 새로운 좀비 군대를 로딩하기 전에 기존의 것을 삭제할 것이네).
    2. 반복을 통해 각 id마다 getZombieDetails(id)를 호출해서 우리의 스마트 컨트랙트에서 좀비에 대한 모든 정보를 찾게. 그리고서
    3. 화면에 표시하기 위해 HTML 템플릿에 좀비에 대한 정보를 집어넣고, 해당 템플릿을 #zombies div에 붙여넣게.

    여기서도 우린 기본 템플릿 엔진이 없는 jQuery를 이용하기 때문에, 보기 싫을 수 있지만, 다음의 간단한 예제처럼 각 좀비에 대한 정보를 출력할 수 있네:

    // 우리 컨트랙트에서 좀비 상세 정보를 찾아, `zombie` 객체 반환
    getZombieDetails(id)
    .then(function(zombie) {
      // HTML에 변수를 넣기 위해 ES6의 "template literal" 사용
      // 각각을 #zombies div에 붙여넣기
      $("#zombies").append(`<div class="zombie">
        <ul>
          <li>Name: ${zombie.name}</li>
          <li>DNA: ${zombie.dna}</li>
          <li>Level: ${zombie.level}</li>
          <li>Wins: ${zombie.winCount}</li>
          <li>Losses: ${zombie.lossCount}</li>
          <li>Ready Time: ${zombie.readyTime}</li>
        </ul>
      </div>`);
    });

    _좀비 스프라이트는 어떻게 표현하나요?
    위 예제에서 우리는 DNA를 문자열로 간단히 표현해 보았네. 하지만 자네의 DApp에서는 이것을 이미지로 바꿔서 자네의 좀비를 표현하고 싶을 걸세.
    우린 DNA 문자열을 부분 문자열로 나누고, 모든 2자리 숫자를 이미지에 대응시켜 아래와 같이 이 작업을 처리했었네:
    ```
    // 좀비의 머리를 표현하는 1-7의 정수 얻기
    var head = parseInt(zombie.dna.substring(0, 2)) % 7 + 1

    // 순차적인 파일 이름으로 7개의 머리 이미지를 가지고 있네:
    var headSrc = "../assets/zombieparts/head-" + head + ".png"
    ```
    각 컴포넌트는 CSS의 절대 좌표 포지셔닝을 이용해 다른 이미지 위에 위치할 걸세. 만약 자네가 우리의 정확한 구현을 보고싶다면, 좀비를 표현하기 위해 우리가 사용한 Vue.js 컴포넌트 소스를 공개해놓았네. 그건 여기에서 볼 수 있네.
    하지만 저 파일에는 많은 코드가 포함되어 있기 때문에, 그건 튜토리얼의 범주 밖이라네. 우린 위에서 본 매우 간단한 jQuery 구현에 집중할 것이고, 좀 더 아름다운 표현은 자네에게 숙제로 남겨두겠네 ?.

    _직접 해보기
    내가 자네를 위해 빈 displayZombies 함수를 만들어두었네. 이제 이걸 채워보도록 하지.
    1. 


-->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>CryptoZombies front-end</title>
    <script language="javascript" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script language="javascript" type="text/javascript" src="web3.min.js"></script>
    <script language="javascript" type="text/javascript" src="cryptozombies_abi.js"></script>
  </head>
  <body>
    <div id="zombies"></div>

    <script>
      var cryptoZombies;
      var userAccount;

      function startApp() {
        var cryptoZombiesAddress = "YOUR_CONTRACT_ADDRESS";
        cryptoZombies = new web3js.eth.Contract(cryptoZombiesABI, cryptoZombiesAddress);

        var accountInterval = setInterval(function() {
          // 계정이 바뀌었는지 확인
          if (web3.eth.accounts[0] !== userAccount) {
            userAccount = web3.eth.accounts[0];
            // 새 계정에 대한 UI로 업데이트하기 위한 함수 호출
            getZombiesByOwner(userAccount)
            .then(displayZombies);
          }
        }, 100);
      }

      function displayZombies(ids){
        //Start here
        $("#zombies").empty();
        for(id of ids){
          getZombieDetails(id)
          .then(function(zombie) {
            $("#zombies").append(
              `<div class="zombie">
                <ul>
                  <li>Name: ${zombie.name}</li>
                  <li>DNA: ${zombie.dna}</li>
                  <li>Level: ${zombie.level}</li>
                  <li>Wins: ${zombie.winCount}</li>
                  <li>Losses: ${zombie.lossCount}</li>
                  <li>Ready Time: ${zombie.readyTime}</li>
                </ul>
              </div>`
            );
          });
        }
      }

      function getZombieDetails(id) {
        return cryptoZombies.methods.zombies(id).call()
      }

      function zombieToOwner(id) {
        return cryptoZombies.methods.zombieToOwner(id).call()
      }

      function getZombiesByOwner(owner) {
        return cryptoZombies.methods.getZombiesByOwner(owner).call()
      }

      window.addEventListener('load', function() {

        // Web3가 브라우저에 주입되었는지 확인(Mist/MetaMask)
        if (typeof web3 !== 'undefined') {
          // Mist/MetaMask의 프로바이더 사용
          web3js = new Web3(web3.currentProvider);
        } else {
          // 사용자가 Metamask를 설치하지 않은 경우에 대해 처리
          // 사용자들에게 Metamask를 설치하라는 등의 메세지를 보여줄 것
        }

        // 이제 자네 앱을 시작하고 web3에 자유롭게 접근할 수 있네:
        startApp()

      })
    </script>
  </body>
</html>


