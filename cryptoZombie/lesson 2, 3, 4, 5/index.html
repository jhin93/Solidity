<!-- 챕터 2: Web3 프로바이더(Provider)
    훌륭해! 이제 우리의 프로젝트에 Web3.js를 넣었으니, 이를 초기화하고 블록체인과 대화를 해보도록 하지.
    우리가 처음 필요로 하는 것은 Web3 프로바이더(Provider)이네.
    기억하게, 이더리움은 똑같은 데이터의 복사본을 공유하는 _노드_들로 구성되어 있네. Web3.js에서 Web3 프로바이더를 설정하는 것은 우리 코드에 읽기와 쓰기를 처리하려면 어떤 노드와 통신을 해야 하는지 설정하는 것이지. 이는 전통적인 웹 앱에서 API 호출을 위해 원격 웹 서버의 URL을 설정하는 것과 같네.
    자네는 자네만의 이더리움 노드를 프로바이더로 운영할 수도 있네. 하지만 자네가 편리하게 쓸 수 있는 제3자 서비스가 있네. 자네 DApp의 사용자들을 위해 자네만의 이더리움 노드를 운영할 필요가 없도록 하기 위해 사용할 수 있는 서비스 말이네 - Infura라는 게 있지.

    _Infura
    Infura는 빠른 읽기를 위한 캐시 계층을 포함하는 다수의 이더리움 노드를 운영하는 서비스이네. 접근을 위한 API를 무료로 사용할 수 있지. Infura를 프로바이더로 사용하면, 자네만의 이더리움을 설치하고 계속 유지할 필요 없이 이더리움 블록체인과 메세지를 확실히 주고받을 수 있네.
    다음과 같이 Web3에 자네의 Web3 프로바이더로 Infura를 쓰도록 설정할 수 있네:
    var web3 = new Web3(new Web3.providers.WebsocketProvider("wss://mainnet.infura.io/ws"));
    하지만, 많은 사용자들이 우리의 DApp을 사용할 것이기에 - 그리고 이 사용자들은 단순히 읽기만 하는 게 아니라 블록체인에 뭔가 쓰기도 할 것이기에 - 우리는 이 사용자들이 그들의 개인 키로 트랜잭션에 서명을 할 수 있도록 해야 할 것이네.
    (참고: 이더리움(그리고 일반적으로 블록체인)은 트랜잭션에 전자 서명을 하기 위해 공개/개인 키 쌍을 사용하네. 말하자면 전자 서명을 위해 엄청나게 안전한 비밀번호 같은 것이지. 
    이런 방식으로 내가 만약 블록체인에서 어떤 데이터를 변경하면, 나의 공개 키를 통해 내가 거기 서명을 한 사람이라고 증명할 수 있네 - 하지만 아무도 내 개인 키를 모르기 때문에, 내 트랜잭션을 누구도 위조할 수 없지)

    이런 암호학은 복잡하네. 그러니 자네가 보안 전문가이고 진짜로 무엇을 하고 있는지 알지 못한다면, 우리의 앱 프론트엔드에서 사용자들의 개인 키를 관리하려 하는 것은 아마 좋은 생각이 아닐 것이네.
    하지만 운이 좋게도 자네는 그렇게 할 필요가 없네 - 이를 대신 처리해주는 서비스가 이미 있네. 이중 가장 유명한 것은 메타마스크(Metamask)이네.

    _메타마스크(Metamask)
    메타마스크는 사용자들이 이더리움 계정과 개인 키를 안전하게 관리할 수 있게 해주는 크롬과 파이어폭스의 브라우저 확장 프로그램이네. 
    그리고 해당 계정들을 써서 Web3.js를 사용하는 웹사이트들과 상호작용을 할 수 있도록 해주지(만약 자네가 이걸 써본 적이 없다면, 자네는 분명 이걸 설치해보고 싶을 것이네 - 그러면 자네의 브라우저에서 Web3가 작동하고, 이더리움 블록체인과 통신하는 어떤 웹사이트와도 상호작용을 할 수 있지!).

    그리고 개발자로서, 사용자들이 웹 브라우저를 써서 웹사이트를 통해 자네의 DApp과 상호작용을 하길 원한다면(우리의 크립토좀비 게임에서 하듯이), 자네는 분명 자네 DApp을 메타마스크와 호환할 수 있게 하고 싶을 것이네.
    (참고: 메타마스크는 내부적으로 Infura의 서버를 Web3 프로바이더로 사용하네. 위에서 우리가 했던 것처럼 말이야 - 하지만 사용자들에게 그들만의 Web3 프로바이더를 선택할 수 있는 옵션을 주기도 하지. 
     즉, 메타마스크의 Web3 프로바이더를 사용하면, 사용자에게 선택권을 주는 것이기도 하면서 자네 앱에서 걱정할 거리를 하나 줄일 수 있지.)

    _메타마스크의 Web3 프로바이더 사용하기
    메타마스크는 web3라는 전역 자바스크립트 객체를 통해 브라우저에 Web3 프로바이더를 주입하네. 그러니 자네 앱에서는 web3가 존재하는지 확인하고, 만약 존재한다면 web3.currentProvider를 프로바이더로서 사용하면 되지.
    여기 메타마스크에서 제공하는 템플릿 코드가 있네. 사용자가 메타마스크를 설치했는지 확인하고 설치가 안 된 경우 우리 앱을 사용하려면 메타마스크를 설치해야 한다고 알려주는 것이지:

        window.addEventListener('load', function() {

        // Web3가 브라우저에 주입되었는지 확인(Mist/MetaMask)
        if (typeof web3 !== 'undefined') {
            // Mist/MetaMask의 프로바이더 사용
            web3js = new Web3(web3.currentProvider);
        } else {
            // 사용자가 Metamask를 설치하지 않은 경우에 대해 처리
            // 사용자들에게 Metamask를 설치하라는 등의 메세지를 보여줄 것
        }

        // 이제 자네 앱을 시작하고 web3에 자유롭게 접근할 수 있네:
        startApp()

        })

    자네는 자네가 만드는 모든 앱에서 이 예제 코드를 사용할 수 있네. 사용자들이 자네 앱을 쓰기 위해 메타마스크를 사용하도록 하려면 말이네.
    (참고: 메타마스크 말고도 사용자들이 쓸 수 있는 다른 개인 키 관리 프로그램도 있네. 미스트(Mist) 웹 브라우저 같은 것들이지. 
     하지만, 그것들도 모두 web3 변수를 주입하는 동일한 형태를 사용하네. 그러니 사용자들이 다른 프로그램을 쓰더라도 여기서 우리가 설명하는 방식으로 사용자의 Web3 프로바이더를 인식할 수 있을 것이네)

    _직접 해보기
    HTML 파일에서 </body> 태그를 써서 닫기 전에 빈 script 태그를 만들어 놓았네. 여기에 이번 레슨을 위한 자바스크립트 코드를 쓸 수 있는 것이지.
    1. 위에서 말한 메타마스크를 인식하기 위한 템플릿 코드를 코드를 복사/붙여넣기 하게. window.addEventListener로 시작하는 블록이네.

-->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>CryptoZombies front-end</title>
    <script language="javascript" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script language="javascript" type="text/javascript" src="web3.min.js"></script>
  </head>
  <body>
    <script>
      // 여기서 시작하게.
      window.addEventListener('load', function() {
        // Web3가 브라우저에 주입되었는지 확인(Mist/MetaMask)
        if (typeof web3 !== 'undefined') {
          // Mist/MetaMask의 프로바이더 사용
          web3js = new Web3(web3.currentProvider);
        } else {
          // 사용자가 Metamask를 설치하지 않은 경우에 대해 처리
          // 사용자들에게 Metamask를 설치하라는 등의 메세지를 보여줄 것
        }
        // 이제 자네 앱을 시작하고 web3에 자유롭게 접근할 수 있네:
        startApp()
      })
    </script>
  </body>
</html>

