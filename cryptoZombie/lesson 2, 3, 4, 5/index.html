<!-- 챕터 5: 메타마스크 & 계정
    대단하군! 자네는 자네의 첫 스마트 컨트랙트와 상호작용을 할 수 있는 프론트엔드 코드를 성공적으로 작성했네.
    이제 각 요소들을 하나로 합쳐나가도록 하겠네 - 우리 앱의 홈페이지에 사용자의 전체 좀비 군대를 보여주고 싶다고 가정해보지.
    현재 사용자가 가지고 있는 모든 좀비들의 ID를 찾기 위해 우리는 분명 첫 번째로 getZombiesByOwner(owner) 함수를 사용해야 할 것이네.
    하지만 우리의 솔리디티 컨트랙트는 owner에 솔리디티 address를 보내도록 되어 있네. 그렇다면 우리가 어떻게 우리 앱을 사용하는 사용자의 주소를 알 수 있겠는가?

    _메타마스크에서 사용자 계정 가져오기
    메타마스크는 확장 프로그램 안에서 사용자들이 다수의 계정을 관리할 수 있도록 해주네. 우리는 주입되어 있는 web3 변수에 현재 활성화된 계정이 무엇인지 다음처럼 확인할 수 있지:
    var userAccount = web3.eth.accounts[0]

    사용자가 언제든지 메타마스크에서 활성화된 계정을 바꿀 수 있기 때문에, 우리 앱은 이 변수의 값이 바뀌었는지 확인하기 위해 계속 감시를 하고 값이 바뀌면 그에 따라 UI를 업데이트해야 할 것이네. 
    예를 들어, 사용자들의 홈페이지에서 그들의 좀비 군대를 표시하고 싶다면, 메타마스크에서 계정을 바꾸었을 때 바뀐 계정에 대한 좀비 군대를 보여주기 위해 페이지를 업데이트해야 할 것이네.
    이를 위해 다음과 같이 setInterval을 쓸 수 있네:
    ```
    var accountInterval = setInterval(function() {
      // 계정이 바뀌었는지 확인
      if (web3.eth.accounts[0] !== userAccount) {
        userAccount = web3.eth.accounts[0];
        // 새 계정에 대한 UI로 업데이트하기 위한 함수 호출
        updateInterface();
      }
    }, 100);
    ```
    여기서는 userAccount가 여전히 web3.eth.accounts[0]과 같은지 확인하기 위해 100밀리초마다 확인하고 있네(즉 사용자가 해당 계정을 활성화해놓았는지 확인하는 것이지). 
    그렇지 않다면, userAccount에 현재 활성화된 계정을 다시 할당하고, 화면을 업데이트하기 위한 함수를 호출하네.

    _직접 해보기
    페이지가 처음 로드될 때 사용자의 좀비 군대를 우리 앱에서 보여줄 수 있게 만들어 보도록 하지. 그리고 활성화 계정이 바뀌면 화면을 갱신할 수 있게 감시를 할 것이네.
    
    1. userAccount라는 이름으로 var를 선언하게. 값을 할당하지는 않도록 하게.
    2. startApp()의 마지막 부분에서, 위의 accountInterval 예제 코드를 복사/붙여넣기 하게.
    3. updateInterface(); 줄을 getZombiesByOwner를 호출하는 것으로 교체하고 userAccount를 전달하게.
    4. getZombiesByOwner 이후 then절을 이어 결과값을 displayZombies라는 이름의 함수로 전달하게(구문은 다음과 같네: .then(displayZombies);).
    5. displayZombies라는 함수를 아직 만들지 않았지만, 다음 챕터에서 이를 구현할 것이네.


-->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>CryptoZombies front-end</title>
    <script language="javascript" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script language="javascript" type="text/javascript" src="web3.min.js"></script>
    <script language="javascript" type="text/javascript" src="cryptozombies_abi.js"></script>
  </head>
  <body>

    <script>
      var cryptoZombies;
      // 1. 여기에 `userAccount`를 선언하게.
      var userAccount;

      function startApp() {
        var cryptoZombiesAddress = "YOUR_CONTRACT_ADDRESS";
        cryptoZombies = new web3js.eth.Contract(cryptoZombiesABI, cryptoZombiesAddress);

        // 2. 여기에 `setInterval` 코드를 만들게.
        var accountInterval = setInterval(function() {
          // 계정이 바뀌었는지 확인
          if (web3.eth.accounts[0] !== userAccount) {
            userAccount = web3.eth.accounts[0];
            // 새 계정에 대한 UI로 업데이트하기 위한 함수 호출
            getZombiesByOwner(userAccount)
            .then(displayZombies);
          }
        }, 100);
      }

      function getZombieDetails(id) {
        return cryptoZombies.methods.zombies(id).call()
      }

      function zombieToOwner(id) {
        return cryptoZombies.methods.zombieToOwner(id).call()
      }

      function getZombiesByOwner(owner) {
        return cryptoZombies.methods.getZombiesByOwner(owner).call()
      }

      window.addEventListener('load', function() {

        // Web3가 브라우저에 주입되었는지 확인(Mist/MetaMask)
        if (typeof web3 !== 'undefined') {
          // Mist/MetaMask의 프로바이더 사용
          web3js = new Web3(web3.currentProvider);
        } else {
          // 사용자가 Metamask를 설치하지 않은 경우에 대해 처리
          // 사용자들에게 Metamask를 설치하라는 등의 메세지를 보여줄 것
        }

        // 이제 자네 앱을 시작하고 web3에 자유롭게 접근할 수 있네:
        startApp()

      })
    </script>
  </body>
</html>


